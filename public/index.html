<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SaeRo AI Editor</title>

    <script src="https://unpkg.com/docx@8.5.0/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"></script>

<style>
    /* ================================================================== */
    /* == ê¸°ë³¸ ë° ì „ì²´ ë ˆì´ì•„ì›ƒ == */
    /* ================================================================== */
    html {
        box-sizing: border-box;
    }
    *, *:before, *:after {
        box-sizing: inherit;
    }
    html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: sans-serif;
        overflow: hidden; /* í˜ì´ì§€ ìì²´ì˜ ìŠ¤í¬ë¡¤ë°”ë¥¼ ì›ì²œì ìœ¼ë¡œ ë°©ì§€ */
    }
    .main-container {
        display: flex;
        flex-direction: column;
        height: 100vh;
    }
    .Section1 {
        height: 1cm;
        background-color: #f0f0f0;
        padding: 0 20px;
        display: flex;
        justify-content: flex-end;
        align-items: center;
        flex-shrink: 0;
    }
    .brand-logo { font-weight: bold; color: #c62828; font-size: 1.2em; }
    .brand-highlight { color: black; }
    .user-info { margin-left: 15px; font-size: 0.9em; color: #555; }
    
    .content-container {
        flex-grow: 1;
        display: flex;
        padding: 10px;
        gap: 10px;
        overflow: hidden;
    }
    .content-column {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-width: 0;
    }
    
    /* ================================================================== */
    /* == íƒ­ ì‹œìŠ¤í…œ ìŠ¤íƒ€ì¼ == */
    /* ================================================================== */
    .tab-content-area {
        flex: 1;
        border: 1px solid black;
        margin-top: 10px;
        display: flex;
    }
    .tab-content-pane {
        display: none;
    }
    .tab-content-pane.active {
        display: block;
        flex: 1;
        overflow-y: auto;
        padding: 10px;
    }
    .tab-bar {
        height: 1cm;
        background-color: #FFFFFF;
        display: flex;
        flex-shrink: 0;
    }
    .tab-list { display: flex; flex: 1; overflow-x: auto; white-space: nowrap;}
    .tab { padding: 8px 4px; cursor: pointer; background-color: #fff; display: flex; align-items: center; position: relative; justify-content: space-between; flex-shrink: 0; border: 1px solid black; margin-right: -1px; }
    .tab-controls { display: flex; }
    .tab-nav-button { padding: 0 12px; display: flex; align-items: center; justify-content: center; background-color: #f0f0f0; border: 1px solid black; border-top:none; cursor: pointer; font-size: 1.2em; color: #555; }
    .tab-nav-button:hover { background-color: #e0e0e0; }
    .tab.active { background-color: #f0f0f0; border-bottom: 3px solid #c62828; font-weight: bold; position: relative; top: -1px; z-index: 1; }
    .close-tab { width: 16px; height: 16px; line-height: 16px; text-align: center; font-size: 12px; border-radius: 50%; }
    .close-tab:hover { background-color: #ffcdd2; }
    .tab-edit-input { border: 1px solid #999; outline: none; padding: 1px 3px; width: 80px; font-family: inherit; font-size: inherit; }

    /* ================================================================== */
    /* == í¸ì§‘ê¸° ë‚´ë¶€ ìŠ¤íƒ€ì¼ == */
    /* ================================================================== */
    .container {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    .section {
        background-color: #f8f9fa;
        padding: 8px 10px;
        border: 1px solid black;
        border-radius: 6px;
        flex-shrink: 0;
    }
    .form-group {
        display: flex;
        align-items: center;
        width: 100%; /* â–¼ ê° í•­ëª©ì´ í•œ ì¤„ì„ ëª¨ë‘ ì°¨ì§€í•˜ë„ë¡ ë„ˆë¹„ 100% ì„¤ì • */
    }
    .form-group label { margin-right: 5px; color: #555; flex-shrink: 0; font-size: 12px; }
    .form-group input, 
    .form-group select {
        padding: 5px; 
        border: 1px solid black; 
        border-radius: 3px; 
        font-size: 12px; 
    }

    #docTitle {
        flex-grow: 1;
    }

    .global-settings-grid { 
        display: flex; 
        flex-direction: column; /* â–¼ ì„¸ë¡œ ë°©í–¥ìœ¼ë¡œ ì •ë ¬ */
        align-items: flex-start;  /* ì™¼ìª½ ì •ë ¬ */
        gap: 6px;             /* â–¼ ì„¸ë¡œ í•­ëª© ê°„ì˜ ê°„ê²©ì„ 8pxë¡œ ì¡°ì • */
        max-height: 60px;     /* â–¼ 2ê°œ í•­ëª©ì´ ë³´ì´ë„ë¡ ìµœëŒ€ ë†’ì´ ì¬ì¡°ì • */
        overflow-y: auto;       /* ë‚´ìš©ì´ ë„˜ì¹˜ë©´ ì„¸ë¡œ ìŠ¤í¬ë¡¤ í‘œì‹œ */
        padding-right: 5px;     /* ìŠ¤í¬ë¡¤ë°” ê³µê°„ í™•ë³´ */
    }

    .syntax-buttons-wrapper { display: flex; flex-wrap: wrap; gap: 6px; max-height: 60px; overflow-y: auto; padding-right: 5px;}
    .syntax-buttons-wrapper button { padding: 4px 8px; font-size: 11px; color: white; border: none; border-radius: 3px; cursor: pointer; transition: transform 0.05s ease-out; }
    .syntax-buttons-wrapper button:active { transform: scale(0.95); }
    .syntax-buttons-wrapper button small { font-size: 0.85em; opacity: 0.9; margin-left: 6px;}
    .syntax-buttons-wrapper button.group1 { background-color: #007bff; }
    .syntax-buttons-wrapper button.group2 { background-color: #28a745; }
    .syntax-buttons-wrapper button.group3 { background-color: #ffc107; color: #212529;}
    .syntax-buttons-wrapper button.group4 { background-color: #17a2b8; }
    .syntax-buttons-wrapper button.group5 { background-color: #6f42c1; } 

    .simple-find-replace-bar { 
        display: flex;
        flex-direction: column;
        gap: 6px;
        padding: 6px 6px;
        align-items: flex-start; /* ìì‹ ìš”ì†Œë“¤ì„ ì™¼ìª½ìœ¼ë¡œ ì •ë ¬ */
    }

    .find-replace-inputs {
        display: flex;
        gap: 10px;
        width: 100%;
        align-items: center; /* ë¼ë²¨ê³¼ ì…ë ¥ì°½ì„ ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
    }
    .find-replace-inputs label {
        display: flex;
        align-items: center;
        gap: 5px;          /* 'ì°¾ê¸°:' ê¸€ìì™€ ì…ë ¥ì°½ ì‚¬ì´ ê°„ê²© */
        font-size: 12px;     /* 'ì°¾ê¸°:' ê¸€ì í¬ê¸° ì¡°ì • */
    }
    .find-replace-inputs input {
        width: 180px /* ë¼ë²¨ ì•ˆì—ì„œ ì…ë ¥ì°½ì´ ê½‰ ì°¨ë„ë¡ ì„¤ì • */
    }

    .find-replace-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
    }

    .syntax-button-like { background-color: #f8f9fa; border: 1px solid black; border-radius: 3px; font-size: 11.5px; padding: 4px 8px; cursor: pointer; }
    .main-editor-area { flex-grow: 1; display: flex; flex-direction: column; padding: 4px; min-height: 200px; }
    #mainTextArea, #memoTextArea { width: 100%; height: 100%; border: none; resize: none; font-size: 13px; line-height: 1.5; padding: 8px; }
    .action-buttons { display: flex; justify-content: flex-end; gap: 4px; margin-top: 4px; flex-wrap: wrap; } 
    .action-buttons button { padding: 4px 4px; border: none; border-radius: 3px; cursor: pointer; font-weight: 500; font-size: 12px; }
    .action-buttons .open-drive { background-color: #007bff; color: white; }
    .action-buttons .load-file { background-color: #17a2b8; color: white; } 
    .action-buttons .save-draft { background-color: #ffc107; color: #333; }
    .action-buttons .create-doc { background-color: #28a745; color: white; }
    .action-buttons .delete-all { background-color: #dc3545; color: white; }

    /* ================================================================== */
    /* == ì»¤ìŠ¤í…€ íŒì—… ìŠ¤íƒ€ì¼ == */
    /* ================================================================== */
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); display: flex; justify-content: center; align-items: center; z-index: 1000; }
    .modal-content { background-color: #fff; padding: 25px 35px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); text-align: center; }
    .modal-content p { margin: 0 0 20px 0; font-size: 1em; color: #333; }
    .modal-content button { padding: 8px 25px; border: 1px solid black; border-radius: 5px; background-color: #f0f0f0; cursor: pointer; font-size: 0.9em; transition: background-color 0.2s; }
    .modal-content button:hover { background-color: #e0e0e0; }

    .custom-alert-popup {
        position: fixed; /* í™”ë©´ì— ê³ ì • */
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5); /* ë°˜íˆ¬ëª… ë°°ê²½ */
        display: flex;
        justify-content: center; /* ê°€ë¡œ ì¤‘ì•™ ì •ë ¬ */
        align-items: center;     /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
        z-index: 1000;
    }

    .custom-alert-content {
        background-color: #fff;
        padding: 25px 35px;
        border-radius: 8px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        text-align: center;
        min-width: 280px;
    }
    .custom-alert-content p {
        margin: 0 0 20px 0;
        font-size: 1em;
        color: #333;
    }
    .custom-alert-content button, .custom-alert-content .button-group button {
        padding: 8px 25px;
        border: 1px solid black;
        border-radius: 5px;
        background-color: #f0f0f0;
        cursor: pointer;
        font-size: 0.9em;
        transition: background-color 0.2s;
        margin: 0 5px;
    }
    .custom-alert-content button:hover, .custom-alert-content .button-group button:hover {
        background-color: #e0e0e0;
    }
    .custom-alert-content .button-group {
        display: flex;
        justify-content: center;
    }

    /* ================================================================== */
    /* == ë°”ë‹¥ê¸€ ìŠ¤íƒ€ì¼ == */
    /* ================================================================== */
    .Section3 {
        height: 0.5cm;
        background-color: #f0f0f0;
        padding: 0 20px;
        font-size: 8pt;
        color: #666;
        text-align: left;
        display: flex;
        align-items: center;
        flex-shrink: 0;
    }
</style>

</head>
<body>
    <div class="main-container">
        <div class="Section1">
            <span class="brand-logo">SaeRo <span class="brand-highlight">AI Editor</span></span>
            <span class="user-info">[<span id="user-name"></span>, <span id="user-phone"></span>]</span>
        </div>

        <div class="content-container">
            <div class="content-column Section2-1"></div>
            <div class="content-column Section2-2"></div>
            <div class="content-column Section2-3"></div>
        </div>

        <div class="Section3">
            <p>&copy; 2025 ë²•ë¥ ì‚¬ë¬´ì†Œ ìƒˆë¡œ ë°•ì˜ˆì¤€. All Rights Reserved.</p>
        </div>
    </div>


<script>
const userName = "ë°•ì˜ˆì¤€2";
const userPhone = "010-9876-5432";
document.getElementById('user-name').textContent = userName;
document.getElementById('user-phone').textContent = userPhone;


// ==================================================================
// SECTION 1: HTML ì½˜í…ì¸  ìƒì„± í•¨ìˆ˜
// ==================================================================

function getPrompterListHtml() {
Â  Â  return `<ul><li>í”„ë¡¬í”„í„° í•­ëª© 1</li><li>í”„ë¡¬í”„í„° í•­ëª© 2</li><li>í”„ë¡¬í”„í„° í•­ëª© 3</li></ul>`;
}

function getEditorHtml() {
    // 3.htmlì˜ UI êµ¬ì¡°ì—ì„œ ì œëª©(h1)ê³¼ ë‹«ê¸° ë²„íŠ¼ì„ ì œê±°í•œ ìµœì¢… ë²„ì „
    return `
      <div class="container">
        <div class="section">
          <div class="form-group"> 
            <label for="docTitle">ë¬¸ì„œì œëª©:</label>
            <input type="text" id="docTitle" placeholder="ì…ë ¥í•˜ì§€ ì•Šìœ¼ë©´ ë‚ ì§œ/ì‹œê°„ìœ¼ë¡œ ìë™ ìƒì„±">
          </div>
        </div>
        <div class="section">
          <div class="global-settings-grid">
            <div class="form-group"> <label for="fontFamily">ê¸€ê¼´:</label> <select id="fontFamily"> <option value="Noto Sans KR">Noto Sans KR</option> <option value="Malgun Gothic">ë§‘ì€ ê³ ë”•</option> <option value="Arial">Arial</option> <option value="Times New Roman">Times New Roman</option> <option value="Calibri">Calibri</option> <option value="Batang" selected>ë°”íƒ•</option> <option value="Dotum">ë‹ì›€</option> </select> </div>
            <div class="form-group"> <label for="fontSize">í¬ê¸°(pt):</label> <input type="number" id="fontSize" value="12" min="8"> </div>
            <div class="form-group"> <label for="lineSpacing">ì¤„ê°„ê²©:</label> <input type="number" id="lineSpacing" value="1.5" step="0.1" min="1"> </div>
            <div class="form-group"> <label for="paraSpacingAfter">ë¬¸ë‹¨ë’¤(pt):</label> <input type="number" id="paraSpacingAfter" value="10" min="0"> </div>
            <div class="form-group"> <label for="pageOrientation">ìš©ì§€ë°©í–¥:</label> <select id="pageOrientation"> <option value="PORTRAIT" selected>ì„¸ë¡œ</option> <option value="LANDSCAPE">ê°€ë¡œ</option></select></div> 
            <div class="form-group"> <label for="marginTop">ì—¬ë°±-ìœ„(cm):</label> <input type="number" id="marginTop" value="2.0" step="0.1" min="0"> </div>
            <div class="form-group"> <label for="marginBottom">ì—¬ë°±-ì•„ë˜(cm):</label> <input type="number" id="marginBottom" value="2.0" step="0.1" min="0"> </div>
            <div class="form-group"> <label for="marginLeft">ì—¬ë°±-ì¢Œ(cm):</label> <input type="number" id="marginLeft" value="2.5" step="0.1" min="0"> </div>
            <div class="form-group"> <label for="marginRight">ì—¬ë°±-ìš°(cm):</label> <input type="number" id="marginRight" value="2.5" step="0.1" min="0"> </div>
          </div>
        </div>
        <div class="section">
            <div class="syntax-buttons-wrapper">
                <button class="group1" onclick="insertSyntax('{ì œëª©1.1}')" title="Alt+1">{ì œëª©1.1} <small>[Alt+1]</small></button>
                <button class="group1" onclick="insertSyntax('{ì œëª©1.2}')" title="Alt+2">{ì œëª©1.2} <small>[Alt+2]</small></button>
                <button class="group1" onclick="insertSyntax('{ì œëª©1.3}')" title="Alt+3">{ì œëª©1.3} <small>[Alt+3]</small></button>
                <button class="group1" onclick="insertSyntax('{ì œëª©2.1}')" title="Alt+4">{ì œëª©2.1} <small>[Alt+4]</small></button>
                <button class="group1" onclick="insertSyntax('{ì œëª©2.2}')" title="Alt+5">{ì œëª©2.2} <small>[Alt+5]</small></button>
                <button class="group1" onclick="insertSyntax('{ì œëª©2.3}')" title="Alt+6">{ì œëª©2.3} <small>[Alt+6]</small></button>
                <button class="group1" onclick="insertSyntax('{ì œëª©3.1}')" title="Alt+7">{ì œëª©3.1} <small>[Alt+7]</small></button>
                <button class="group1" onclick="insertSyntax('{ì œëª©3.2}')" title="Alt+8">{ì œëª©3.2} <small>[Alt+8]</small></button>
                <button class="group1" onclick="insertSyntax('{ì œëª©3.3}')" title="Alt+9">{ì œëª©3.3} <small>[Alt+9]</small></button>
                <button class="group2" onclick="insertSyntax('{ì™¼ìª½}')" title="Alt+Q">{ì™¼ìª½} <small>[Alt+Q]</small></button>
                <button class="group2" onclick="insertSyntax('{ê°€ìš´ë°}')" title="Alt+W">{ê°€ìš´ë°} <small>[Alt+W]</small></button>
                <button class="group2" onclick="insertSyntax('{ì˜¤ë¥¸ìª½}')" title="Alt+E">{ì˜¤ë¥¸ìª½} <small>[Alt+E]</small></button>
                <button class="group2" onclick="insertSyntax('{ì–‘ìª½}')" title="Alt+R">{ì–‘ìª½} <small>[Alt+R]</small></button>
                <button class="group2" onclick="insertSyntax('{ê· ë“±}')" title="Alt+T">{ê· ë“±} <small>[Alt+T]</small></button>
                <button class="group2" onclick="insertSyntax('{10pt}')" title="Alt+Y">{10pt} <small>[Alt+Y]</small></button>
                <button class="group2" onclick="insertSyntax('{1ì¤„}')" title="Alt+U">{1ì¤„} <small>[Alt+U]</small></button>
                <button class="group2" onclick="insertSyntax('{ë“¤ì—¬ì“°ê¸°,1ë²ˆì¤„:0.5,2ë²ˆì¤„ì´í•˜:0.5}')" title="Alt+I">{ë“¤ì—¬ì“°ê¸°...} <small>[Alt+I]</small></button>
                <button class="group2" onclick="insertSyntax('{ë“¤ì—¬ì“°ê¸°,1ë²ˆì¤„:1,2ë²ˆì¤„ì´í•˜:1}')" title="Alt+O">{ë“¤ì—¬ì“°ê¸°...} <small>[Alt+O]</small></button>
                <button class="group2" onclick="insertSyntax('{ë“¤ì—¬ì“°ê¸°,1ë²ˆì¤„:0,2ë²ˆì¤„ì´í•˜:0.5}')" title="Alt+P">{ë“¤ì—¬ì“°ê¸°...} <small>[Alt+P]</small></button>
                <button class="group2" onclick="insertSyntax('{ë“¤ì—¬ì“°ê¸°,1ë²ˆì¤„:0.5,2ë²ˆì¤„ì´í•˜:1}')" title="Alt+[">{ë“¤ì—¬ì“°ê¸°...} <small>[Alt+[ ]</small></button>
                <button class="group3" onclick="insertSyntax('{ì§„í•˜ê²Œ}')" title="Alt+A">{ì§„í•˜ê²Œ} <small>[Alt+A]</small></button>
                <button class="group3" onclick="insertSyntax('{ë°‘ì¤„}')" title="Alt+S">{ë°‘ì¤„} <small>[Alt+S]</small></button>
                <button class="group3" onclick="insertSyntax('{>>}')" title="Alt+D">{>>} <small>[Alt+D]</small></button>
                <button class="group3" onclick="insertSyntax('{<<}')" title="Alt+F">{<<} <small>[Alt+F]</small></button>
                <button class="group3" onclick="insertSyntax('{íƒ­}')" title="Alt+G">{íƒ­} <small>[Alt+G]</small></button>
                <button class="group3" onclick="insertSyntax('{ì¤„ë°”ê¿ˆ}')" title="Alt+H">{ì¤„ë°”ê¿ˆ} <small>[Alt+H]</small></button>
                <button class="group3" onclick="insertSyntax('{ë¬¸ë‹¨ë°”ê¿ˆ}')" title="Alt+J">{ë¬¸ë‹¨ë°”ê¿ˆ} <small>[Alt+J]</small></button>
                <button class="group3" onclick="insertSyntax('{í˜ì´ì§€ë°”ê¿ˆ}')" title="Alt+K">{í˜ì´ì§€ë°”ê¿ˆ} <small>[Alt+K]</small></button>
                <button class="group4" onclick="insertSyntax('{í‘œì‹œì‘1,ê¸€ê¼´=??,í¬ê¸°=#}')" title="Alt+Z">{í‘œì‹œì‘1...} <small>[Alt+Z]</small></button>
                <button class="group4" onclick="insertSyntax('{í‘œì‹œì‘1,í…Œë‘ë¦¬ì—†ìŒ}')" title="Alt+X">{í‘œì‹œì‘1,í…Œë‘ë¦¬ì—†ìŒ} <small>[Alt+X]</small></button>
                <button class="group4" onclick="insertSyntax('{í‘œë1}')" title="Alt+C">{í‘œë1} <small>[Alt+C]</small></button>
                <button class="group4" onclick="insertSyntax('{í‘œì‹œì‘2,ê¸€ê¼´=??,í¬ê¸°=#}')" title="Alt+V">{í‘œì‹œì‘2...} <small>[Alt+V]</small></button>
                <button class="group4" onclick="insertSyntax('{í‘œë2}')" title="Alt+B">{í‘œë2} <small>[Alt+B]</small></button>
                <button class="group4" onclick="insertSyntax('{ì œëª©í–‰}')" title="Alt+N">{ì œëª©í–‰} <small>[Alt+N]</small></button>
                <button class="group4" onclick="insertSyntax('{íšŒìƒ‰}')" title="Alt+M">{íšŒìƒ‰} <small>[Alt+M]</small></button>
                <button class="group4" onclick="insertSyntax('{ë‚¨ìƒ‰}')" title="Alt+,">{ë‚¨ìƒ‰} <small>[Alt+,]</small></button>
                <button class="group4" onclick="insertSyntax('{ê·¸ë¦¼:~}')" title="Alt+.">{ê·¸ë¦¼:~} <small>[Alt+.]</small></button>            </div>
        </div>

        <div class="section simple-find-replace-bar">
            <div class="find-replace-inputs">
                <label>ì°¾ê¸°: <input type="text" id="simpleFindText"></label>
                <label>ë°”ê¾¸ê¸°: <input type="text" id="simpleReplaceText"></label>
            </div>
            <div class="find-replace-buttons">
                <button class="syntax-button-like" onclick="simpleFindNext()">ë‹¤ìŒ ì°¾ê¸°</button>
                <button class="syntax-button-like" onclick="simpleReplaceCurrent()">ë°”ê¾¸ê¸°</button>
                <button class="syntax-button-like" onclick="previewSelectionBeforeReplaceAll()">ëª¨ë‘ ë°”ê¾¸ê¸°</button>
                <button class="syntax-button-like" onclick="performUndo()">ë˜ëŒë¦¬ê¸°</button> 
                <button class="syntax-button-like" onclick="resetFindReplace()">ì´ˆê¸°í™”</button>
            </div>
        </div>

        <div class="section main-editor-area">
          <textarea id="mainTextArea" placeholder="ì—¬ê¸°ëŠ” ë¬¸ì„œë¡œ ì‘ì„±í•  ë‚´ìš©ì„ ì…ë ¥í•˜ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤."></textarea>
        </div>

        <div class="section" style="flex-shrink: 1; flex-grow: 0; min-height: 100px; display: flex; flex-direction: column; padding: 4px;">
            <textarea id="memoTextArea" placeholder="ì—¬ê¸°ëŠ” ë³¸ë¬¸ ì‘ì„±ì‹œì— ì°¸ê³ í•  ë‚´ìš©ì„ ë©”ëª¨í•˜ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤.&#10;ë¬¸ì„œë¡œ ì‘ì„±ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤."></textarea>
        </div>

        <div class="action-buttons"><button class="open-drive" onclick="showCustomAlert('ì¤€ë¹„ ì¤‘ì¸ ê¸°ëŠ¥ì…ë‹ˆë‹¤.')">Google Drive</button><button class="load-file" onclick="showCustomAlert('ì¤€ë¹„ ì¤‘ì¸ ê¸°ëŠ¥ì…ë‹ˆë‹¤.')">ë¶ˆëŸ¬ì˜¤ê¸°</button><button class="save-draft" onclick="showCustomAlert('ì¤€ë¹„ ì¤‘ì¸ ê¸°ëŠ¥ì…ë‹ˆë‹¤.')">ì €ì¥<small style="font-weight: normal; margin-left: 3px;">[Ctrl+S]</small></button><button class="create-doc" onclick="createWordClientSide()">ë¬¸ì„œì‘ì„±</button><button class="delete-all" onclick="clearTextArea()">ì „ì²´ì‚­ì œ</button></div>

      </div>
      <div id="loadingPopup" class="loading-popup" style="display: none;"> 
        <div class="loading-popup-content"> <p>ì‘ì—… ì§„í–‰ ì¤‘... <span id="loadingTimeElapsed">[0.00 Sec]</span></p> <div class="progress-bar-container"><div class="progress-bar-animated"></div></div></div> 
      </div>
      <div id="customConfirm" class="custom-alert-popup" style="display: none;">
        <div class="custom-alert-content"> <p id="customConfirmMessage"></p> <div class="button-group"><button id="customConfirmOkButton">í™•ì¸</button><button id="customConfirmCancelButton">ì·¨ì†Œ</button></div></div>
      </div>
      <div id="customAlert" class="custom-alert-popup" style="display: none;">
        <div class="custom-alert-content"> <p id="customAlertMessage"></p> <button id="customAlertOkButton">í™•ì¸</button></div>
      </div>
    `;
}

// ==================================================================
// SECTION 2: í¸ì§‘ê¸° ë° UI ë¡œì§ í•¨ìˆ˜
// ==================================================================

// --- ì „ì—­ ë³€ìˆ˜ ì„ ì–¸ ---
let mainTextArea, memoTextArea, docTitleInput, fontFamilySelect, fontSizeInput, lineSpacingInput, paraSpacingAfterInput, loadingPopup, marginTopInput, marginBottomInput, marginLeftInput, marginRightInput;
let undoStack = [];
let loadingTimerIntervalId = null;
let loadingStartTime = 0;

// --- UI í”¼ë“œë°± í•¨ìˆ˜ (íŒì—…, ë¡œë”©) ---
function showLoadingPopup() { if (!loadingPopup) return; loadingPopup.style.display = 'flex'; loadingStartTime = Date.now(); const timeDisplay = document.getElementById('loadingTimeElapsed'); if (timeDisplay) timeDisplay.textContent = '[0.00 Sec]'; if (loadingTimerIntervalId) clearInterval(loadingTimerIntervalId); loadingTimerIntervalId = setInterval(() => { const elapsedTimeMs = Date.now() - loadingStartTime; if (timeDisplay) timeDisplay.textContent = `[${(elapsedTimeMs / 1000).toFixed(2)} Sec]`; }, 100); }
function hideLoadingPopup() { if (!loadingPopup) return; loadingPopup.style.display = 'none'; if (loadingTimerIntervalId) { clearInterval(loadingTimerIntervalId); loadingTimerIntervalId = null; } }
function showCustomAlert(message) { const popup = document.getElementById('customAlert'); const messageEl = document.getElementById('customAlertMessage'); const okButton = document.getElementById('customAlertOkButton'); if (!popup || !messageEl || !okButton) return; messageEl.textContent = message; popup.style.display = 'flex'; okButton.onclick = () => popup.style.display = 'none'; }
function showCustomConfirm(message) { const popup = document.getElementById('customConfirm'); const messageEl = document.getElementById('customConfirmMessage'); const okButton = document.getElementById('customConfirmOkButton'); const cancelButton = document.getElementById('customConfirmCancelButton'); if (!popup || !messageEl || !okButton || !cancelButton) return Promise.reject(); return new Promise((resolve, reject) => { messageEl.textContent = message; popup.style.display = 'flex'; okButton.onclick = () => { popup.style.display = 'none'; resolve(true); }; cancelButton.onclick = () => { popup.style.display = 'none'; reject(false); }; }); }

// --- í•µì‹¬ í¸ì§‘ ê¸°ëŠ¥ (ë¬¸ì„œ ìƒì„±, ì €ì¥, ë¶ˆëŸ¬ì˜¤ê¸°) ---
function createDocument() { if (!mainTextArea) return; showLoadingPopup(); let docTitle = docTitleInput.value.trim(); if (!docTitle) { docTitle = generateFilename('[ì‘ì„±]'); } const settings = { fontFamily: fontFamilySelect.value, fontSize: fontSizeInput.value, lineSpacing: lineSpacingInput.value, paraSpacingAfter: paraSpacingAfterInput.value, pageOrientation: document.getElementById('pageOrientation').value, marginTop: marginTopInput.value, marginBottom: marginBottomInput.value, marginLeft: marginLeftInput.value, marginRight: marginRightInput.value }; const payload = { content: mainTextArea.value, memoContent: memoTextArea.value }; google.script.run.withSuccessHandler(onCreateDocSuccess).withFailureHandler(onFailure).createDocumentInDrive(payload, docTitle, settings); }
function saveDraft() { if (!mainTextArea) return; showLoadingPopup(); let docTitle = docTitleInput.value.trim(); if (!docTitle) { docTitle = generateFilename('[ì €ì¥]'); } const settings = { fontFamily: fontFamilySelect.value, fontSize: fontSizeInput.value, lineSpacing: lineSpacingInput.value, paraSpacingAfter: paraSpacingAfterInput.value, pageOrientation: document.getElementById('pageOrientation').value, marginTop: marginTopInput.value, marginBottom: marginBottomInput.value, marginLeft: marginLeftInput.value, marginRight: marginRightInput.value }; const payload = { content: mainTextArea.value, memoContent: memoTextArea.value, settings: settings }; google.script.run.withSuccessHandler(message => { hideLoadingPopup(); showCustomAlert(message); }).withFailureHandler(onFailure).saveDraftToServer(payload, docTitle); }
function loadTextFileList() { showLoadingPopup(); google.script.run.withSuccessHandler(showFileListPopup).withFailureHandler(onFailure).getRecentTxtFilesFromDrive(); }
function showFileListPopup(fileList) { hideLoadingPopup(); if (!fileList || fileList.length === 0) { showCustomAlert("ì €ì¥ëœ TXT íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤."); return; } const listHtml = fileList.map(file => `<div style="margin-bottom:6px;"><button onclick="loadTxtFile('${file.id}', this)" title="${file.name}" style="width:100%;padding:6px 10px;font-size:13px;border:1px solid black;border-radius:5px;background:#fff;text-align:left;cursor:pointer;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;">${file.name}</button></div>`).join(""); const wrapper = document.createElement('div'); wrapper.id = "loadFileModal"; Object.assign(wrapper.style, { position: "fixed", top: "60px", left: "50%", transform: "translateX(-50%)", background: "#fff", border: "1px solid #444", boxShadow: "0 4px 12px rgba(0,0,0,0.3)", borderRadius: "8px", zIndex: "10000", width: "calc(100% - 40px)", maxWidth: "840px", maxHeight: "80vh", display: "flex", flexDirection: "column" }); wrapper.innerHTML = `<div style="padding:16px 20px;border-bottom:1px solid black;font-size:17px;font-weight:bold;text-align:center;background:#f9f9f9;">ë¶ˆëŸ¬ì˜¤ê¸°</div><div style="flex:1;overflow-y:auto;padding:16px 20px;">${listHtml}</div><div style="padding:12px 20px;border-top:1px solid black;text-align:right;background:#f9f9f9;"><button onclick="document.getElementById('loadFileModal').remove()" style="padding:6px 14px;font-size:13px;background:#444;color:white;border:none;border-radius:4px;">ë‹«ê¸°</button></div>`; document.body.appendChild(wrapper); }
function loadTxtFile(fileId, buttonElement) { showLoadingPopup(); google.script.run.withSuccessHandler(result => { hideLoadingPopup(); const modal = document.getElementById("loadFileModal"); if (modal) modal.remove(); if (!result) return; docTitleInput.value = result.name.replace(/\[ì €ì¥\]\s*/, "").replace(/_\d{4}-\d{2}-\d{2} \d{2}ê‰\d{2}\.txt$/, "").replace(/\.txt$/, ""); try { const data = JSON.parse(result.content); mainTextArea.value = data.content || ''; memoTextArea.value = data.memoContent || ''; if (data.settings) { fontFamilySelect.value = data.settings.fontFamily || 'Batang'; fontSizeInput.value = data.settings.fontSize || '12'; lineSpacingInput.value = data.settings.lineSpacing || '1.5'; paraSpacingAfterInput.value = data.settings.paraSpacingAfter || '10'; document.getElementById('pageOrientation').value = data.settings.pageOrientation || 'PORTRAIT'; marginTopInput.value = data.settings.marginTop || '2.0'; marginBottomInput.value = data.settings.marginBottom || '2.0'; marginLeftInput.value = data.settings.marginLeft || '2.5'; marginRightInput.value = data.settings.marginRight || '2.5'; } showCustomAlert("íŒŒì¼ê³¼ ì„¤ì •ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤."); } catch (e) { mainTextArea.value = result.content; showCustomAlert("íŒŒì¼ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤. (ì„¤ì •ê°’ ë¯¸í¬í•¨)"); } }).withFailureHandler(onFailure).getTxtFileContent(fileId); }
async function clearTextArea() { if (!mainTextArea) return; try { await showCustomConfirm('ë¬¸ì„œ ì œëª©, ë‚´ìš©, ë©”ëª¨ë¥¼ ì „ì²´ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'); mainTextArea.value = ''; memoTextArea.value = ''; docTitleInput.value = ''; showCustomAlert('ì œëª©, ë‚´ìš©, ë©”ëª¨ê°€ ëª¨ë‘ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.'); } catch (error) { console.log('ì‚­ì œ ì·¨ì†Œ'); } }

// --- ì°¾ê¸°/ë°”ê¾¸ê¸° ë° ì‹¤í–‰ ì·¨ì†Œ ---

function simpleFindNext() {
    const term = document.getElementById('simpleFindText').value;
    if (!term) {
        showCustomAlert('ì°¾ì„ ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
        return;
    }

    // 1. í˜„ì¬ ì„ íƒëœ ì˜ì—­ ë°”ë¡œ ë’¤ë¶€í„° ê²€ìƒ‰ì„ ì‹œì‘í•©ë‹ˆë‹¤.
    let searchStartIndex = mainTextArea.selectionEnd;
    let foundIndex = mainTextArea.value.indexOf(term, searchStartIndex);

    // 2. ë§Œì•½ ìœ„ì—ì„œ ëª» ì°¾ì•˜ë‹¤ë©´, ë¬¸ì„œ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ê²€ìƒ‰í•©ë‹ˆë‹¤ (ìˆœí™˜ ê²€ìƒ‰).
    if (foundIndex === -1) {
        // ì´ì „ì— ì„ íƒëœ ìœ„ì¹˜ì™€ ê²¹ì¹˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ê²€ìƒ‰í•©ë‹ˆë‹¤.
        const wrapAroundIndex = mainTextArea.value.indexOf(term, 0);

        // ë§Œì•½ ì²˜ìŒë¶€í„° ê²€ìƒ‰í•´ë„ ê²°ê³¼ê°€ ì—†ê±°ë‚˜, ê²°ê³¼ê°€ í˜„ì¬ ì„ íƒëœ ê²ƒê³¼ ê°™ë‹¤ë©´
        // ì´ëŠ” ë” ì´ìƒ ìƒˆë¡œìš´ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.
        if (wrapAroundIndex === -1 || wrapAroundIndex === mainTextArea.selectionStart) {
            showCustomAlert('"' + term + '" ì„(ë¥¼) ë¬¸ì„œì—ì„œ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }
        // ì²˜ìŒë¶€í„° ê²€ìƒ‰í•œ ê²°ê³¼ë¥¼ ìµœì¢… ê²°ê³¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
        foundIndex = wrapAroundIndex;
    }
    
    // 3. ìµœì¢…ì ìœ¼ë¡œ ì°¾ì€ ìœ„ì¹˜ê°€ ìˆë‹¤ë©´, íŒì—… ì—†ì´ í•´ë‹¹ í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
    mainTextArea.focus();
    mainTextArea.setSelectionRange(foundIndex, foundIndex + term.length);
}

function simpleReplaceCurrent() { const term = document.getElementById('simpleFindText').value; const replacement = document.getElementById('simpleReplaceText').value; const start = mainTextArea.selectionStart; const end = mainTextArea.selectionEnd; if (start === end || mainTextArea.value.substring(start, end) !== term) { simpleFindNext(); return; } undoStack.push({ value: mainTextArea.value, selectionStart: start, selectionEnd: end }); const before = mainTextArea.value.substring(0, start); const after = mainTextArea.value.substring(end); mainTextArea.value = before + replacement + after; mainTextArea.setSelectionRange(start, start + replacement.length); simpleFindNext(); }
async function previewSelectionBeforeReplaceAll() { const term = document.getElementById('simpleFindText').value; const replacement = document.getElementById('simpleReplaceText').value; if (!term) { showCustomAlert("ì°¾ì„ ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”."); return; } const start = mainTextArea.selectionStart; const end = mainTextArea.selectionEnd; const scope = (start !== end) ? "ì„ íƒëœ ì˜ì—­" : "ì „ì²´ ë¬¸ì„œ"; try { await showCustomConfirm(`'${term}' ì„(ë¥¼) '${replacement}' (ìœ¼)ë¡œ ${scope}ì—ì„œ ëª¨ë‘ ë°”ê¾¸ì‹œê² ìŠµë‹ˆê¹Œ?`); undoStack.push({ value: mainTextArea.value, selectionStart: start, selectionEnd: end }); let count = 0; const regex = new RegExp(term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g'); if (scope === "ì„ íƒëœ ì˜ì—­") { const before = mainTextArea.value.substring(0, start); const selected = mainTextArea.value.substring(start, end); const after = mainTextArea.value.substring(end); const replacedText = selected.replace(regex, () => { count++; return replacement; }); mainTextArea.value = before + replacedText + after; mainTextArea.setSelectionRange(start, start + replacedText.length); } else { mainTextArea.value = mainTextArea.value.replace(regex, () => { count++; return replacement; }); } showCustomAlert(`ì´ ${count}ê°œë¥¼ ë°”ê¿¨ìŠµë‹ˆë‹¤.`); } catch (error) { console.log('ëª¨ë‘ ë°”ê¾¸ê¸° ì·¨ì†Œ'); } }
function resetFindReplace() { document.getElementById('simpleFindText').value = ''; document.getElementById('simpleReplaceText').value = ''; mainTextArea.focus(); }
function performUndo() {
Â  Â  if (undoStack.length > 0) {
Â  Â  Â  Â  const previous = undoStack.pop();
Â  Â  Â  Â  mainTextArea.value = previous.value;
Â  Â  Â  Â  mainTextArea.setSelectionRange(previous.selectionStart, previous.selectionEnd);
Â  Â  Â  Â  mainTextArea.focus();
Â  Â  }
}

// --- ìœ í‹¸ë¦¬í‹° ë° ë³´ì¡° í•¨ìˆ˜ ---
function generateFilename(prefix) { const now = new Date(); const yymmdd = now.getFullYear().toString().slice(-2) + (now.getMonth() + 1).toString().padStart(2, '0') + now.getDate().toString().padStart(2, '0'); const hhmmss = now.getHours().toString().padStart(2, '0') + now.getMinutes().toString().padStart(2, '0') + now.getSeconds().toString().padStart(2, '0'); return `${prefix}ì œëª©ì—†ìŒ_${yymmdd}_T${hhmmss}`; }
function insertSyntax(syntax) { if (!mainTextArea) return; const { scrollTop, selectionStart, selectionEnd, value } = mainTextArea; mainTextArea.value = value.substring(0, selectionStart) + syntax + value.substring(selectionEnd); mainTextArea.focus(); mainTextArea.selectionStart = mainTextArea.selectionEnd = selectionStart + syntax.length; mainTextArea.scrollTop = scrollTop; }
function openGoogleDrive() { showLoadingPopup(); google.script.run.withSuccessHandler(folderUrl => { hideLoadingPopup(); if (folderUrl) window.open(folderUrl, "_blank"); else showCustomAlert("í´ë” ì—´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."); }).withFailureHandler(onFailure).getOrCreateSaeroDraftFolderUrl(); }
function onFailure(error) { hideLoadingPopup(); showCustomAlert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message); }
function onCreateDocSuccess(payload) { hideLoadingPopup(); if (payload && payload.base64Data) { triggerBrowserDownload(payload); } else if (payload && payload.googleDocUrl) { window.open(payload.googleDocUrl, '_blank'); showCustomAlert('Google ë¬¸ì„œ ìƒì„±ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤ (Word ë³€í™˜ì€ ì‹¤íŒ¨).'); } else { onFailure({ message: "ì„œë²„ë¡œë¶€í„° ìœ íš¨í•œ ì‘ë‹µì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤." }); } }
function triggerBrowserDownload(payload) { const decodedData = atob(payload.base64Data); const byteNumbers = new Array(decodedData.length); for (let i = 0; i < decodedData.length; i++) { byteNumbers[i] = decodedData.charCodeAt(i); } const byteArray = new Uint8Array(byteNumbers); const blob = new Blob([byteArray], { type: payload.mimeType }); const url = window.URL.createObjectURL(blob); const a = document.createElement('a'); a.style.display = 'none'; a.href = url; a.download = payload.fileName; document.body.appendChild(a); a.click(); window.URL.revokeObjectURL(url); document.body.removeChild(a); showCustomAlert(`'${payload.fileName}' íŒŒì¼ ë‹¤ìš´ë¡œë“œê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.`); }
function handleContextScroll(isScrollingDown) { if (!mainTextArea) return; const computedStyle = window.getComputedStyle(mainTextArea); const lineHeight = parseFloat(computedStyle.lineHeight); const scrollAmount = mainTextArea.clientHeight - (3 * lineHeight); let newScrollTop = isScrollingDown ? mainTextArea.scrollTop + scrollAmount : mainTextArea.scrollTop - scrollAmount; mainTextArea.scrollTo({ top: newScrollTop, behavior: 'smooth' }); }

// ==================================================================
// SECTION 3: íƒ­ ì»´í¬ë„ŒíŠ¸ ìƒì„± ë° ê´€ë¦¬
// ==================================================================
function createTabComponent(targetSelector, title, initialContentHtml) {
    const container = document.querySelector(targetSelector);
    if (!container) { console.error(targetSelector + ' ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); return; }
    container.innerHTML = `<div><span>${title}</span></div><div class="tab-content-area"><div class="tab-content-pane active" data-tab-id="tab1">${initialContentHtml}</div></div><div class="tab-bar"><div class="tab-nav-button tab-scroll-btn" data-direction="-1">&lt;</div><div class="tab-list"><div class="tab active" data-tab-id="tab1"><span>tab1</span><span class="close-tab">Ã—</span></div></div><div class="tab-controls"><div class="tab-nav-button add-tab-btn">+</div><div class="tab-nav-button tab-scroll-btn" data-direction="1">&gt;</div></div></div>`;
    const tabList = container.querySelector('.tab-list');
    const tabContentArea = container.querySelector('.tab-content-area');
    const addButton = container.querySelector('.add-tab-btn');
    let tabCounter = 1;
    addButton.addEventListener('click', () => { tabCounter++; const newTabId = `tab${tabCounter}`; const activeTab = tabList.querySelector('.tab.active'); if (activeTab) activeTab.classList.remove('active'); const activePane = tabContentArea.querySelector('.tab-content-pane.active'); if (activePane) activePane.classList.remove('active'); const newTab = document.createElement('div'); newTab.className = 'tab active'; newTab.dataset.tabId = newTabId; newTab.innerHTML = `<span>${newTabId}</span><span class="close-tab">Ã—</span>`; tabList.appendChild(newTab); const newPane = document.createElement('div'); newPane.className = 'tab-content-pane active'; newPane.dataset.tabId = newTabId; newPane.innerHTML = `<p>${newTabId}ì˜ ìƒˆë¡œìš´ ì½˜í…ì¸  ì˜ì—­ì…ë‹ˆë‹¤.</p>`; tabContentArea.appendChild(newPane); tabList.scrollLeft = tabList.scrollWidth; });
    tabList.addEventListener('click', (event) => { const target = event.target; if (target.classList.contains('close-tab')) { const tabToRemove = target.closest('.tab'); const paneToRemove = tabContentArea.querySelector(`[data-tab-id="${tabToRemove.dataset.tabId}"]`); if (tabList.querySelectorAll('.tab').length === 1) { showCustomAlert('ë§ˆì§€ë§‰ íƒ­ì€ ë‹«ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); return; } if (tabToRemove.classList.contains('active')) { const nextTab = tabToRemove.previousElementSibling && tabToRemove.previousElementSibling.classList.contains('tab') ? tabToRemove.previousElementSibling : tabToRemove.nextElementSibling; if (nextTab) nextTab.click(); } tabToRemove.remove(); paneToRemove.remove(); return; } const clickedTab = target.closest('.tab'); if (clickedTab) { tabList.querySelectorAll('.tab').forEach(t => t.classList.remove('active')); tabContentArea.querySelectorAll('.tab-content-pane').forEach(p => p.classList.remove('active')); clickedTab.classList.add('active'); const correspondingPane = tabContentArea.querySelector(`[data-tab-id="${clickedTab.dataset.tabId}"]`); if (correspondingPane) { correspondingPane.classList.add('active'); } } });
    tabList.addEventListener('dblclick', (event) => { const target = event.target; if (!target.matches('.tab > span:first-of-type')) { return; } const currentSpan = target; const currentName = currentSpan.textContent; const tempInput = document.createElement('input'); tempInput.type = 'text'; tempInput.value = currentName; tempInput.className = 'tab-edit-input'; currentSpan.style.display = 'none'; currentSpan.after(tempInput); tempInput.focus(); tempInput.select(); const finishEditing = () => { let newName = tempInput.value.trim(); if (!newName) { currentSpan.textContent = currentName; } else { const otherTabSpans = [...tabList.querySelectorAll('.tab > span:first-of-type')].filter(span => span !== currentSpan); const existingNames = otherTabSpans.map(span => span.textContent); let finalName = newName; let counter = 2; while (existingNames.includes(finalName)) { finalName = `${newName} (${counter})`; counter++; } currentSpan.textContent = finalName; } tempInput.remove(); currentSpan.style.display = ''; }; tempInput.addEventListener('blur', finishEditing); tempInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') { finishEditing(); } }); });
    container.querySelectorAll('.tab-scroll-btn').forEach(button => { button.addEventListener('click', () => { const direction = parseInt(button.dataset.direction, 10); const scrollAmount = 200; tabList.scrollBy({ left: scrollAmount * direction, behavior: 'smooth' }); }); });
}


// ==================================================================
// SECTION 4: í˜ì´ì§€ ì´ˆê¸°í™” ë° ì „ì—­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
// ==================================================================

function initializeEditorVariables() {
    mainTextArea = document.getElementById('mainTextArea');
    memoTextArea = document.getElementById('memoTextArea');
    docTitleInput = document.getElementById('docTitle');
    fontFamilySelect = document.getElementById('fontFamily');
    fontSizeInput = document.getElementById('fontSize');
    lineSpacingInput = document.getElementById('lineSpacing');
    paraSpacingAfterInput = document.getElementById('paraSpacingAfter');
    loadingPopup = document.getElementById('loadingPopup');
    marginTopInput = document.getElementById('marginTop');
    marginBottomInput = document.getElementById('marginBottom');
    marginLeftInput = document.getElementById('marginLeft');
    marginRightInput = document.getElementById('marginRight');
}

document.addEventListener('DOMContentLoaded', () => {
    // 1. íƒ­ ì»´í¬ë„ŒíŠ¸ë“¤ ìƒì„±
    createTabComponent('.Section2-1', 'â–  Prompter Selector', getPrompterListHtml());
    createTabComponent('.Section2-2', 'ğŸ”¥ AI ì±„íŒ…', '<p>AIì™€ ëŒ€í™”ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”.</p>');
    createTabComponent('.Section2-3', 'â–  Editor', getEditorHtml());

    // 2. í¸ì§‘ê¸° UIê°€ DOMì— ì¶”ê°€ëœ í›„, ì „ì—­ ë³€ìˆ˜ì— DOM ìš”ì†Œ í• ë‹¹
    initializeEditorVariables();

    // 3. ì „ì—­ ë‹¨ì¶•í‚¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
    document.addEventListener('keydown', function(event) {
        if (event.altKey) {
            event.preventDefault();
            const keyMap = {
                '1': '{ì œëª©1.1}', '2': '{ì œëª©1.2}', '3': '{ì œëª©1.3}', '4': '{ì œëª©2.1}', '5': '{ì œëª©2.2}', '6': '{ì œëª©2.3}', '7': '{ì œëª©3.1}', '8': '{ì œëª©3.2}', '9': '{ì œëª©3.3}',
                'q': '{ì™¼ìª½}', 'w': '{ê°€ìš´ë°}', 'e': '{ì˜¤ë¥¸ìª½}', 'r': '{ì–‘ìª½}', 't': '{ê· ë“±}', 'y': '{10pt}', 'u': '{1ì¤„}',
                'i': '{ë“¤ì—¬ì“°ê¸°,1ë²ˆì¤„:0.5,2ë²ˆì¤„ì´í•˜:0.5}', 'o': '{ë“¤ì—¬ì“°ê¸°,1ë²ˆì¤„:1,2ë²ˆì¤„ì´í•˜:1}', 'p': '{ë“¤ì—¬ì“°ê¸°,1ë²ˆì¤„:0,2ë²ˆì¤„ì´í•˜:0.5}', '[': '{ë“¤ì—¬ì“°ê¸°,1ë²ˆì¤„:0.5,2ë²ˆì¤„ì´í•˜:1}',
                'a': '{ì§„í•˜ê²Œ}', 's': '{ë°‘ì¤„}', 'd': '{>>}', 'f': '{<<}', 'g': '{íƒ­}', 'h': '{ì¤„ë°”ê¿ˆ}', 'j': '{ë¬¸ë‹¨ë°”ê¿ˆ}', 'k': '{í˜ì´ì§€ë°”ê¿ˆ}',
                'z': '{í‘œì‹œì‘1,ê¸€ê¼´=??,í¬ê¸°=#}', 'x': '{í‘œì‹œì‘1,í…Œë‘ë¦¬ì—†ìŒ}', 'c': '{í‘œë1}', 'v': '{í‘œì‹œì‘2,ê¸€ê¼´=??,í¬ê¸°=#}', 'b': '{í‘œë2}',
                'n': '{ì œëª©í–‰}', 'm': '{íšŒìƒ‰}', ',': '{ë‚¨ìƒ‰}', '.': '{ê·¸ë¦¼:~}'
            };
            const syntax = keyMap[event.key.toLowerCase()];
            if (syntax) { insertSyntax(syntax); }
        }

        if ((event.ctrlKey || event.metaKey) && event.key.toLowerCase() === 'z') {
Â  Â  Â  Â  Â  Â  // 'ì°¾ê¸°/ë°”ê¾¸ê¸°'ë¡œ ì¶”ê°€ëœ ë˜ëŒë¦¬ê¸° ë‚´ìš©ì´ ìˆì„ ê²½ìš°ì—ë§Œ ì§ì ‘ ì²˜ë¦¬
Â  Â  Â  Â  Â  Â  if (undoStack.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  event.preventDefault(); // ë¸Œë¼ìš°ì € ê¸°ë³¸ ë™ì‘ ë°©ì§€
Â  Â  Â  Â  Â  Â  Â  Â  performUndo();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  // ë˜ëŒë¦´ ë‚´ìš©ì´ ì—†ìœ¼ë©´ ì•„ë¬´ê²ƒë„ ì•ˆ í•¨ -> ë¸Œë¼ìš°ì €ê°€ ê¸°ë³¸ ë˜ëŒë¦¬ê¸°(ì¼ë°˜ í…ìŠ¤íŠ¸ ì…ë ¥ ì·¨ì†Œ) ì‹¤í–‰
Â  Â  Â  Â  }

        if ((event.ctrlKey || event.metaKey) && event.key.toLowerCase() === 's') { event.preventDefault(); saveDraft(); }
        if (event.key === 'PageDown') { event.preventDefault(); handleContextScroll(true); }
        if (event.key === 'PageUp') { event.preventDefault(); handleContextScroll(false); }
    });
});

async function createWordClientSide() {
    showLoadingPopup(); // ë¡œë”© íŒì—… í‘œì‹œ

    // 1. UIì—ì„œ ëª¨ë“  ì„¤ì •ê°’ ê°€ì ¸ì˜¤ê¸°
    const title = docTitleInput.value.trim();
    const content = mainTextArea.value;
    const settings = {
        font_family_east_asia: fontFamilySelect.value,
        font_size: parseFloat(fontSizeInput.value) || 12,
        line_spacing: parseFloat(lineSpacingInput.value) || 1.5,
        para_spacing_after: parseFloat(paraSpacingAfterInput.value) || 10,
        page_orientation: document.getElementById('pageOrientation').value,
        margin_top: parseFloat(marginTopInput.value) || 2.0,
        margin_bottom: parseFloat(marginBottomInput.value) || 2.0,
        margin_left: parseFloat(marginLeftInput.value) || 2.5,
        margin_right: parseFloat(marginRightInput.value) || 2.5,
    };
    
    // --- [í•µì‹¬] Cloud Run ë°±ì—”ë“œë¡œ ë°ì´í„° ì „ì†¡ ---
    try {
        // 2. ìš°ë¦¬ê°€ ë°°í¬í•œ Cloud Runì˜ URLë¡œ ë°ì´í„°ë¥¼ POST ë°©ì‹ìœ¼ë¡œ ë³´ëƒ…ë‹ˆë‹¤.
        const BACKEND_URL = "https://sraieditor20250711-983424591109.asia-northeast3.run.app"; // â— ì‹¤ì œ ë°°í¬ëœ Cloud Run URL
        
        const response = await fetch(`${BACKEND_URL}/create-docx`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                content: content,
                settings: settings,
                title: title
            }),
        });

        hideLoadingPopup(); // ë¡œë”© íŒì—… ìˆ¨ê¸°ê¸°

        if (response.ok) {
            // 3. ì„œë²„ë¡œë¶€í„° ë°›ì€ íŒŒì¼ ë°ì´í„°(blob)ë¥¼ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤.
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            
            let fileName = title ? `${title}.docx` : 'generated_document.docx';
            a.download = fileName;
            
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            a.remove();
            showCustomAlert(`'${fileName}' íŒŒì¼ ë‹¤ìš´ë¡œë“œê°€ ì‹œì‘ë©ë‹ˆë‹¤.`);
        } else {
            const error = await response.json();
            showCustomAlert('íŒŒì¼ ìƒì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.error);
        }
    } catch (error) {
        hideLoadingPopup();
        console.error('Error:', error);
        // ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ì¢€ ë” ëª…í™•í•˜ê²Œ ìˆ˜ì •
        showCustomAlert('ë°±ì—”ë“œ ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    }
}
    
</script>

</body>
</html>
